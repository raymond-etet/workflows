# ==========================================================================================
# Clash.Meta ç»ˆæä¼˜åŒ–é…ç½® for ã€OpenWrt + AdGuardHome + OpenClashã€‘
# 1. èåˆä¸¤ä»½é…ç½®ä¼˜ç‚¹ï¼Œé‡‡ç”¨æœ€æ–°ã€æœ€ä¸¥è°¨çš„ Clash.Meta API è¯­æ³•ã€‚
# 2. DNS ç»“æ„ä¼˜åŒ–ï¼šåŒºåˆ†ç›´è¿ä¸ä»£ç† DNSï¼Œå¹¶å¼•å…¥ Fallback æœºåˆ¶ï¼ŒæŠ—æ±¡æŸ“ã€é˜²è§£æå¤±è´¥ã€‚
# 5. ç¯å¢ƒé€‚é…ï¼šä¸º "AdGuardHome æ¥ç®¡ 53 -> OpenClash" æ¶æ„è®¾è®¡ï¼Œç§»é™¤å†²çªé¡¹ã€‚
# 6. æ³¨é‡Šè¯¦å°½ï¼šå¯¹æ¯ä¸ªæ¨¡å—å’Œå…³é”®å‚æ•°è¿›è¡Œå®Œæ•´ä¸­æ–‡æ³¨é‡Šã€‚
#
# æ¶æ„çº¦å®šï¼š
# - AdGuard Home ç›‘å¬ 53 ç«¯å£ä½œä¸ºä¸» DNSã€‚
# - AdGuard Home çš„ä¸Šæ¸¸ DNS (Upstream) æŒ‡å‘ Clash çš„ DNS ç›‘å¬ç«¯å£ (7874)ã€‚
# - OpenClash ä½¿ç”¨ Redir æ¨¡å¼è¿›è¡Œé€æ˜ä»£ç†ï¼Œä¸ä½¿ç”¨ TUN æ¨¡å¼ã€‚
# - è§„åˆ™é›†é‡‡ç”¨ GeoIP å’Œ GeoSiteï¼Œä¸ä½¿ç”¨å¤–éƒ¨ rule-set æ–‡ä»¶ã€‚
# ==========================================================================================

# ----------------- åŸºç¡€ç«¯å£ä¸ç½‘ç»œè®¾ç½® -----------------
port: 7890 # HTTP ä»£ç†ç«¯å£
socks-port: 7891 # SOCKS5 ä»£ç†ç«¯å£
mixed-port: 7893 # HTTP å’Œ SOCKS5 æ··åˆç«¯å£
redir-port: 7892 # é€æ˜ä»£ç† (Redirect) TCP ç«¯å£
tproxy-port: 7895 # é€æ˜ä»£ç† (TProxy) UDP ç«¯å£ (å³ä½¿ä¸»è¦ç”¨redirï¼Œä¹Ÿå»ºè®®ä¿ç•™å®šä¹‰)
allow-lan: true # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*" # ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£çš„è¿æ¥
mode: rule # è§„åˆ™æ¨¡å¼ï¼Œæ ¹æ® `rules` åˆ—è¡¨è¿›è¡Œåˆ†æµ
log-level: warning # æ—¥å¿—çº§åˆ«ï¼Œ'warning' èƒ½æ˜¾è‘—å‡å°‘ä¸å¿…è¦çš„æ—¥å¿—è¾“å‡ºï¼Œé™ä½ç³»ç»Ÿè´Ÿè½½
external-controller: 0.0.0.0:9090 # å¤–éƒ¨ UI æ§åˆ¶å™¨åœ°å€ï¼Œå…è®¸å±€åŸŸç½‘å†…æ‰€æœ‰è®¾å¤‡è®¿é—®
secret: "" # å¤–éƒ¨æ§åˆ¶å™¨å¯†é’¥ï¼Œç•™ç©ºè¡¨ç¤ºä¸é‰´æƒ

# ----------------- å®¢æˆ·ç«¯ä¼ªè£… (UA/TLS æŒ‡çº¹) -----------------
global-client-fingerprint: chrome
global-ua: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36 QuarkPC/4.3.2.472"

# ----------------- DNS æ ¸å¿ƒé…ç½® (å…³é”®ä¼˜åŒ–åŒº) -----------------
dns:
  listen: 0.0.0.0:7874 # DNS ç›‘å¬åœ°å€ï¼ŒAdGuardHome åº”å°†æ­¤è®¾ä¸ºä¸Šæ¸¸
  ipv6: false # ç¦ç”¨ IPv6 è§£æã€‚å›½å†…ç¯å¢ƒ IPv6 æ”¯æŒä¸ä½³ï¼Œå…³é—­å¯é¿å…è§£æé”™è¯¯å’Œç½‘ç»œå»¶è¿Ÿ
  use-hosts: true # ä½¿ç”¨ç³»ç»Ÿ hosts æ–‡ä»¶
  respect-rules: true # DNS è§£æç»“æœå°†éµå¾ªåˆ†æµè§„åˆ™
  fake-ip-range: 198.18.0.1/16 # Fake-IP ä½¿ç”¨çš„ IP æ®µï¼Œé‡‡ç”¨ç§æœ‰åœ°å€æ®µï¼Œé¿å…å†²çª
  # [ä¸Šæ¸¸ DNS æœåŠ¡å™¨]
  # ç”¨äºè§£æã€ç›´è¿åŸŸåã€‘(å¦‚å›½å†…ç½‘ç«™) çš„ DNSï¼Œè¿½æ±‚é€Ÿåº¦ä¸æ— æ±¡æŸ“
  # æ³¨æ„ï¼šdefault-nameserver å¿…é¡»ä½¿ç”¨çº¯IPåœ°å€ï¼Œä¸èƒ½ä½¿ç”¨DoH/DoTæ ¼å¼
  fake-ip-filter:
    # å±€åŸŸç½‘ & IoT
    - geosite:cn # å›½å†…åŸŸåå…¨éƒ¨è¿”å›çœŸå® IP
    - geosite:private
    - "+.lan"
    - "+.local"
    - "+.localdomain"

    # Windows / macOS è¿é€šæ€§æ£€æµ‹
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
    - "+.apple.com"
    - "+.push-apple.com.akadns.net"

    # STUN / æ—¶é—´åŒæ­¥ / GitHub
    - time.*.com
    - "+.stun.com"
    - "+.stun.net"
    - "+.github.com"
    - "+.githubusercontent.com"
    - "+.githubassets.com"

      # ===== GitHub ç³»åˆ— =====
    - +.github.com
    - +.githubusercontent.com
    - +.githubassets.com
    - +.githubapp.com
    - +.ghcr.io

      # å¢åŠ ä»¥ä¸‹è§„åˆ™è§£å†³ DNS è§£æé—®é¢˜
    - "+.router.asus.com"
    - "+.local.adguard.org"
    - "+.adguardhome.local"
    - "localhost.ptlogin2.qq.com"
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"

  # ------------- æ™®é€šå…¬å…± DNS åˆ—è¡¨ -------------
  default-nameserver: # å›½å†…å…œåº•ï¼Œä»…ç”¨ IP
    - 139.9.23.90 # å›½å†…æœ€å¿« 114DNS
    - 119.29.29.29 # DNSPodï¼Œå¤‡ç”¨

  nameserver: # å¯èƒ½è¢«ä»£ç†ç”¨çš„ DNS (æµ·å¤–)
    - https://cloudflare-dns.com/dns-query
    - https://dns.google/dns-query

  proxy-server-nameserver: # ä»…è§£æèŠ‚ç‚¹åŸŸåä½¿ç”¨ï¼Œå¿…é¡»æ˜¯çº¯ IP
    - 1.1.1.1
    - 8.8.8.8

  # ------------- DNS åŸŸåçº§ç­–ç•¥ï¼ˆ2025 ä¹‹åæ¨èå…¨å†™è¿™é‡Œï¼‰ -------------
  nameserver-policy:
    # è§„åˆ™ä¸€ï¼šå¤§é™†ï¼ˆå«é¦™æ¸¯ï¼‰æ‰€æœ‰ç­‰ä¸šåŠ¡åŸŸå â†’ ç”¨å›½å†…æœ€å¿«çš„ä¸¤ç»„
    "geosite:cn,apple-cn,microsoft@cn,category-games@cn,private":
      - 139.9.23.90 # å›½å†…æœ€å¿« 114DNS
      - 119.29.29.29 # DNSPodï¼Œå¤‡ç”¨

    # è§„åˆ™äºŒï¼šiCloud åŠå…¶å­æœåŠ¡ â†’ äº¤å›ç³»ç»Ÿ DNSï¼Œå…¼å®¹è‹¹æœè®¾å¤‡
    "geosite:icloud": dhcp

    # è§„åˆ™ä¸‰ï¼ˆå…œåº•ï¼‰ï¼šæ‰€æœ‰å…¶ä»–åŸŸå â†’ èµ°å›½å¤–æ— æ±¡æŸ“ DoH
    "geosite:geolocation-!cn": "nameserver"

# ----------------- æµé‡å—…æ¢ (Sniffer) -----------------
sniffer:
  enable: true
  parse-pure-ip: true
  override-destination: true
  sniffing: [TLS, HTTP, QUIC]
  force-domain:
    # æµåª’ä½“ï¼šåˆ†åŒºæœ€ä¸¥
    - "+.netflix.com"
    - "+.disneyplus.com"
    - "+.hulu.com"
    - "+.hbo.com"
    - "+.amazonprime.com"

    # æ¸¸æˆï¼šä¸åŒåŒºåŸŸåŒ¹é…ä¸åŒå…¥å£
    - "+.steamcontent.com" # Steam ä¸‹è½½ CDN
    - "+.epicgames.com"

    # é“¶è¡Œçš„å›½é™…ç«™
    - "+.paypal.com"

# --- ä»£ç†èŠ‚ç‚¹ (Proxies) ---

# ----------------- è·¯ç”±è§„åˆ™ (Rules) -----------------
# è§„åˆ™ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡åŒ¹é…ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†ç»§ç»­åŒ¹é…
# AdGuardHome å·²å¤„ç†å¹¿å‘Šï¼Œæ­¤å¤„è§„åˆ™å¯ä½œä¸ºè¡¥å……
rules:
  # -- ç›´è¿è§„åˆ™ --
  - GEOIP,PRIVATE,DIRECT # [æœ€ä½³å®è·µ] ç§æœ‰/ä¿ç•™åœ°å€ç›´è¿ï¼Œæœ€é«˜ä¼˜å…ˆçº§
  - GEOSITE,private,DIRECT # GeoSite ç§æœ‰åœ°å€è§„åˆ™
  - DOMAIN-SUFFIX,pc528.net,DIRECT
  - DOMAIN-SUFFIX,pc521.net,DIRECT
  - GEOIP,CN,DIRECT # ä¸­å›½å¤§é™† IP ç›´è¿
  - GEOSITE,cn,DIRECT # ä¸­å›½å¤§é™†åŸŸåç›´è¿
  - GEOSITE,apple-cn,DIRECT # è‹¹æœä¸­å›½æœåŠ¡ç›´è¿
  - GEOSITE,microsoft@cn,DIRECT # å¾®è½¯ä¸­å›½æœåŠ¡ç›´è¿
  - GEOSITE,category-games@cn,DIRECT # å›½å†…æ¸¸æˆç›´è¿

  # -- å…œåº•è§„åˆ™ --
  - MATCH,ğŸš€ èŠ‚ç‚¹é€‰æ‹© # æ‰€æœ‰æœªåŒ¹é…çš„æµé‡å‡èµ°ä»£ç†

# ----------------- æ€§èƒ½ä¸è¿æ¥è°ƒä¼˜ -----------------
tcp-concurrent: true # [æ€§èƒ½] å¯ç”¨ TCP å¹¶å‘è¿æ¥ï¼ŒåŠ å¿«ç½‘ç«™æ‰“å¼€é€Ÿåº¦
udp-idle-timeout: 60 # UDP ä¼šè¯ç©ºé—²è¶…æ—¶æ—¶é—´ (ç§’)
keep-alive-idle: 600 # TCP Keep-Alive ç©ºé—²æ—¶é—´ (ç§’)
keep-alive-interval: 15 # TCP Keep-Alive æ¢æµ‹é—´éš” (ç§’)
udp-strategy: resolve-after-socks5 # [æ–°ç‰¹æ€§] UDP æµé‡åœ¨ SOCKS5 æ¡æ‰‹å®Œæˆåå†è§£æç›®æ ‡åœ°å€ï¼Œå‡å°‘ä¸å¿…è¦çš„ DNS è§£æ
find-process-mode: strict # ä¸¥æ ¼æ¨¡å¼æŸ¥æ‰¾è¿›ç¨‹ï¼Œæ›´å‡†ç¡®
interface-name: "" # å‡ºå£ç½‘å¡åç§°ï¼Œç•™ç©ºåˆ™è‡ªåŠ¨é€‰æ‹©
routing-mark: 0 # è®¾ç½® SO_MARKï¼Œç”¨äºé…åˆ Linux ç­–ç•¥è·¯ç”±ï¼Œä¸€èˆ¬ç•™ç©ºæˆ–ä¸º 0

# ----------------- æŒä¹…åŒ–é…ç½® -----------------
profile:
  store-selected: true # è®°ä½ä¸Šæ¬¡åœ¨ UI ä¸­é€‰æ‹©çš„ç­–ç•¥ç»„èŠ‚ç‚¹
  store-fake-ip: true # ç¼“å­˜ Fake-IP ä¸çœŸå® IP çš„æ˜ å°„å…³ç³»ï¼Œé‡å¯åæ¢å¤ï¼ŒåŠ å¿«è¿æ¥é€Ÿåº¦

# ----------------- å®éªŒæ€§åŠŸèƒ½ -----------------
experimental:
  unified-delay: true # ç»Ÿä¸€è®¡ç®—æ‰€æœ‰ç±»å‹èŠ‚ç‚¹çš„å»¶è¿Ÿï¼Œç»“æœæ›´å…·å¯æ¯”æ€§
  ignore-resolve-fail: true # å¿½ç•¥ DNS è§£æå¤±è´¥ï¼Œé¿å…å•ä¸ªè§£æå¤±è´¥é˜»å¡æ‰€æœ‰è¿æ¥
  cache-file: /tmp/clash.meta.db # ç¼“å­˜æ–‡ä»¶è·¯å¾„
  cache-size: 100000 # æœ€å¤§ç¼“å­˜æ¡ç›®æ•°
  cache-ttl: 3600 # ç¼“å­˜è¿‡æœŸæ—¶é—´ (ç§’)ï¼Œ1 å°æ—¶

# ----------------- Geo-Database (åœ°ç†æ•°æ®åº“) -----------------
geodata-mode: true # å¯ç”¨ GeoIP å’Œ GeoSite
geodata-loader: standard # æ¨è 8GB å†…å­˜ä»¥ä¸Šè®¾å¤‡ï¼Œæ€§èƒ½æ›´å¥½
geo-auto-update: true # è‡ªåŠ¨æ›´æ–° Geo æ•°æ®åº“æ–‡ä»¶
geo-update-interval: 24 # æ¯ 24 å°æ—¶æ›´æ–°ä¸€æ¬¡
geo-auto-fallback: true # æ›´æ–°å¤±è´¥åè‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–é•œåƒæº
