# =================================================================================
# Clash.Meta ä¼˜åŒ–ç‰ˆé…ç½® for [OpenWrt + AdGuard Home + OpenClash] - GeoIPç‰ˆ
#
# ä¼˜åŒ–å†…å®¹:
# 1. ç¦ç”¨IPv6 DNSè§£æï¼Œè§£å†³"ip version error"
# 2. å¯ç”¨GEOSITE/GEOIPæ”¯æŒï¼Œä½¿ç”¨CDNåŠ é€Ÿä¸‹è½½
# 3. ä½¿ç”¨åœ°ç†æ•°æ®åº“è§„åˆ™ç®€åŒ–é…ç½®
# 4. ä¼˜åŒ–DNSé…ç½®ï¼Œæå‡ç¨³å®šæ€§
# 5. ç²¾ç®€å—…æ¢å’Œåˆ†æµè§„åˆ™ï¼Œå‡å°‘å†—ä½™ï¼Œæå‡æ•ˆç‡
# =================================================================================

# --- ç«¯å£è®¾ç½® (ä¿æŒåŸæœ‰é…ç½®) ---
port: 7890
socks-port: 7891
mixed-port: 7893
redir-port: 7892
tproxy-port: 7895

# --- åŸºç¡€è®¾ç½® ---
allow-lan: true
bind-address: "*"
mode: rule
external-controller: 0.0.0.0:9090 # å…è®¸å¤–éƒ¨è®¿é—®
secret: "" # ç©ºå¯†é’¥ï¼Œæ— éœ€éªŒè¯
log-level: warning # å‡å°‘æ—¥å¿—è¾“å‡ºæå‡æ€§èƒ½

# --- DNS é…ç½® (ä¼˜åŒ–ç‰ˆ) ---
dns:
  enable: true
  listen: 0.0.0.0:7874
  ipv6: false # ä¿®å¤: ç¦ç”¨IPv6é¿å…DNSè§£æé”™è¯¯
  prefer-h3: false # ä¿®å¤: ç¦ç”¨HTTP/3é¿å…åè®®é”™è¯¯
  use-hosts: true
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "*.localdomain"
    - "+.stun.*.*"
    - "+.stun.*.*.*"
    - "+.stun.*.*.*.*"
    - "+.stun.*.*.*.*.*"
    - "*.msftconnecttest.com"
    - "*.msftncsi.com"
    - "msftconnecttest.com"
    - "msftncsi.com"

  # å›½å†… DNS - ç”¨äºè§£æéä»£ç†åŸŸå
  # ä¼˜åŒ–: ä»…ä¿ç•™ç¨³å®šå¿«é€Ÿçš„å›½å†…DNSï¼Œé¿å…å¯¹å›½å†…åŸŸåè§£æé€ æˆå»¶è¿Ÿæˆ–æ±¡æŸ“ã€‚
  default-nameserver:
    - 223.5.5.5 # é˜¿é‡ŒDNS
    - 119.29.29.29 # è…¾è®¯DNS
    - 114.114.114.114 # 114DNS

  # å›½å¤– DNS - ç”¨äºè§£æéœ€è¦ä»£ç†çš„åŸŸå
  nameserver:
    - 8.8.8.8 # Google DNS
    - 1.1.1.1 # Cloudflare DNS

  # ä»£ç†DNS (è§£æä»£ç†æœåŠ¡å™¨åŸŸå)
  proxy-server-nameserver:
    - 8.8.8.8
    - 1.1.1.1

  # DNSç­–ç•¥ (ä½¿ç”¨ geosite ç²¾ç®€)
  # ä¼˜åŒ–: geosite:cn å·²åŒ…å«æ‰€æœ‰ .cn åç¼€åŸŸåï¼Œæ— éœ€é‡å¤æ·»åŠ ã€‚
  nameserver-policy:
    "geosite:cn": ["223.5.5.5", "119.29.29.29"]
    "geosite:private": ["system"] # ä¼˜åŒ–: å¯¹å†…ç½‘åŸŸåä½¿ç”¨ç³»ç»ŸDNS
    "+.local": ["system"]

  # Fallback æœºåˆ¶ (å½“å›½å¤–DNSè¿”å›å›½å†…IPæ—¶ï¼Œä½¿ç”¨å›½å†…DNSé‡è§£æ)
  fallback-filter:
    geoip: true # å¯ç”¨geoipè¿‡æ»¤
    geoip-code: CN # ä¸­å›½å¤§é™†IPä½¿ç”¨å›½å†…DNS
    ipcidr: ["240.0.0.0/4", "0.0.0.0/32", "127.0.0.1/32"]
    domain:
      [
        "+.google.com",
        "+.facebook.com",
        "+.youtube.com",
        "+.github.com",
        "+.githubusercontent.com",
      ]

# --- æµé‡æ¢æµ‹ Sniffer (ä¼˜åŒ–ç‰ˆ) ---
sniffer:
  enable: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    TLS:
      ports: [443, 8443]
    HTTP:
      ports: [80, 8080-8880]
  # ä¼˜åŒ–: ä½¿ç”¨ geosite:cn æ›¿ä»£å¤§é‡å†—ä½™çš„åŸŸååç¼€ï¼Œç®€åŒ–é…ç½®
  skip-domain:
    - "*.lan"
    - "*.local"
    - "geosite:cn"

# --- çŠ¶æ€ä¸ç¼“å­˜ ---
profile:
  store-selected: true
  store-fake-ip: true

# --- ä»£ç†èŠ‚ç‚¹ (ä¿æŒåŸæœ‰) ---
proxies:

proxy-groups:
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"

  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    proxies:

    url: http://www.apple.com/library/test/success.html
    interval: 1800

# --- åˆ†æµè§„åˆ™ (ç²¾ç®€ä¼˜åŒ–ç‰ˆ) ---
rules:
  # æœ¬åœ°/å†…ç½‘æµé‡ç›´è¿
  - DOMAIN-SUFFIX,local,DIRECT
  - DOMAIN-SUFFIX,localhost,DIRECT
  - DOMAIN-SUFFIX,lan,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,169.254.0.0/16,DIRECT

  # ä¸­å›½å¤§é™†åŸŸåå’ŒIPç›´è¿ (æ ¸å¿ƒè§„åˆ™)
  - GEOSITE,cn,DIRECT
  - GEOSITE,private,DIRECT
  - GEOIP,cn,DIRECT

  # é¦™æ¸¯IPç›´è¿ (æ ¹æ®ä½ çš„éœ€æ±‚ä¿ç•™)
  - GEOIP,hk,DIRECT

  # ä¼˜åŒ–: ä»¥ä¸‹ DOMAIN-SUFFIX è§„åˆ™å·²è¢« GEOSITE,cn å®Œç¾è¦†ç›–ï¼Œæ•…ç§»é™¤ä»¥ç²¾ç®€é…ç½®ã€‚
  # - DOMAIN-SUFFIX,cn,DIRECT
  # - DOMAIN-SUFFIX,com.cn,DIRECT
  # ... ç­‰ç­‰

  # å›½å¤–çŸ¥åæœåŠ¡èµ°ä»£ç† (ç¡®ä¿ä¸è¢«ä¸Šé¢è§„åˆ™è¯¯åˆ¤)
  - GEOSITE,google,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,github,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,youtube,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,facebook,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,twitter,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,telegram,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,netflix,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # å…¶ä»–æ‰€æœ‰æµé‡èµ°ä»£ç† (æœ€ç»ˆè§„åˆ™)
  - MATCH,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

# --- æ€§èƒ½ä¼˜åŒ– (ä¿æŒåŸæœ‰é…ç½®ï¼Œå·²éå¸¸ä¼˜ç§€) ---
tcp-concurrent: true
udp-idle-timeout: 60
keep-alive-idle: 600
keep-alive-interval: 15

# --- ç½‘ç»œä¼˜åŒ– (ä¿æŒåŸæœ‰é…ç½®) ---
interface-name: ""
routing-mark: 0

# --- å®éªŒæ€§åŠŸèƒ½ (ä¿æŒåŸæœ‰é…ç½®ï¼Œå…¼å®¹æ€§å¥½) ---
experimental:
  unified-delay: true
  ignore-resolve-fail: true
  cache-file: /tmp/clash.db
  cache-size: 100000
  cache-ttl: 3600

# --- æ•…éšœå¤„ç†ä¸é‡è¯•ç­–ç•¥ (ä¿æŒåŸæœ‰é…ç½®) ---
find-process-mode: strict
global-ua: ClashMetaForAndroid/2.8.9.Meta
global-client-fingerprint: chrome

# --- åœ°ç†æ•°æ®åº“é…ç½® (ä¿æŒåŸæœ‰é…ç½®ï¼Œå®Œç¾é€‚é…OpenClash) ---
geo-auto-fallback: true
geo-lazy-load: false
geodata-mode: true
geodata-loader: memconservative
geo-auto-update: false
